---
title: "Ordered Categorical Data"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---

In this tutorial, we are going to use `lavaan` to deal with ordered categorical data. The example corresponds to the *Achievement Goal Questionnaire* example in your course slides.


## Load the pacakges

```{r, message=FALSE, warning=FALSE}
library(lavaan)
library(semPlot)
```

<br>


## Read the data

The data for this example is saved in a txt file named "categorical_data.txt", which is provided as part of the course materials. You can use the `read.delim()` function to read in a txt file. 

In order for `lavaan` to properly deal with categorical data, you should either make sure the categorical variables are declared as "ordered" in your data frame, or the variables are specified as "ordered" when you call up the fitting function.

```{r,echo=F}
mypath <- "/Volumes/GoogleDrive/My Drive/Dpr/EDMS workshops/SEM2019/SEM Second Course Mplus 2019/Advanced Examples/2. Real Data Examples"
```

```{r}
setwd(mypath)  # change it to the path of your own data folder
categorical <- read.delim("categorical_data.txt", sep="\t", header = T)

colnames(categorical) <- c('pap1', 'pap2', 'pap3', 'pav1', 'pav2', 'pav3',
                           'mav1', 'mav2', 'mav3', 'map1', 'map2', 'map3')

categorical <- apply(categorical, 2, ordered)

```

You can take a look at the data and get the sample statistics. 

```{r}

# descriptive statistics

str(categorical)
summary(categorical)


```

<br>


## Fit a CFA model using WLS estimation


```{r, echo = F, warnings = F, message = F, out.width='80%'}

categorical.model='

pap=~NA*pap1+pap2+pap3
pav=~NA*pav1+pav2+pav3
mav=~NA*mav1+mav2+mav3
map=~NA*map1+map2+map3
pap~~1*pap
pav~~1*pav 
mav~~1*mav 
map~~1*map

'

cat.fit=sem(categorical.model,data=categorical,estimator="WLSM",ordered=c('pap1','pap2','pap3','pav1','pav2','pav3','mav1','mav2','mav3','map1','map2','map3'))

semPaths(cat.fit, title = FALSE, curvePivot = TRUE, intercepts = F, optimizeLatRes = T, sizeLat = 10)

```

If you have not declared the variables as "ordered" in your data frame, when you call up the fitting function, you must add the `ordered =` argument to tell `lavaan` which of the variables should be treated as categorical data. 

Whend dealing with categorical data, the current version of `lavaan` only supports WLS estimators and its 'robust' variants. By default, `lavaan` will use the WLSMV estimator for categorical data. You can switch to other estimators using the `estimator = ` argument. For example, I requested to use the WLSM estimator, which is a robust variant of DWLS. It only uses the diagonal of the weight matrix for estimation; but the the standard errors and test statistics are computed based on the full weight matrix. 

```{r}

categorical.model <- '

pap =~  NA*pap1 + pap2 + pap3
pav =~  NA*pav1 + pav2 + pav3
mav =~  NA*mav1 + mav2 + mav3
map =~  NA*map1 + map2 + map3
pap ~~  1*pap
pav ~~  1*pav 
mav ~~  1*mav 
map ~~  1*map

'

cat.fit <- sem(categorical.model,
               data = categorical,
               estimator = "WLSM",
               ordered = c('pap1','pap2','pap3',
                           'pav1','pav2','pav3',
                           'mav1','mav2','mav3',
                           'map1','map2','map3'))

summary(cat.fit, fit.measures = T, standardized = T)

```


<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
